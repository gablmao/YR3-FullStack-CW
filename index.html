<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply for After School Classes</title>
    <link rel="stylesheet" href="style.css">
    <!-- Vue integration here -->
    <!--script src="https://unpkg.com/vue"></script-->
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
</head>

<body>
    <div id="app">
        <header id="header">
            <h1>After School Classes</h1>
            <!-- Pressing updates HTML to show items added in cart -->
            <button v-on:click="toggleCheckoutPage"> {{ cartItemCount }} View Cart</button>
            <!-- {{}} to display number in vue data -->
        </header>



        <!-- state when IN checkout-->
        <div v-if="showCheckout">
            <h1>Your Cart</h1>
            <div id="product" v-for="product in cart">
                <!-- pls expand on this -->
                <!-- <h1>{{ product }}</h1> -->
                <h1>Subject: {{ product.name }}</h1>
                <img v-bind:src="product.image" height="200"> </img>
                <p>Place: {{ product.place }}</p>
                <p>Price: {{ product.price }}</p>
                <button v-on:click="removeItemFromCart(product)">Remove</button></p>

            </div>

            <div v-if="cart.length == 0">
                <p>Nothing to place order!</p>
            </div>

            <div v-else>
                <h2>Order Details</h2>
                <strong>First Name:</strong>
                <!-- v-model affect html inputs, buttons and more. 
                 when inputted, the vue data is updated -->
                <input type="text" v-model="order.firstName">
                <strong>Last Name:</strong>
                <input type="text" v-model="order.lastName">
                <strong>Phone Number:</strong>
                <input type="text" v-model="order.phone">
                <button v-on:click="submitForm">Place Order</button>
            </div>
        </div>


        <!-- state when NOT in checkout -->
        <div v-else>
            <div id="sorts">

                <label v-on:click="getTopicSelect"> Select which to sort:
                    <input type="radio" name="topics" value="name" checked>Name
                    <input type="radio" name="topics" value="place">Place
                    <input type="radio" name="topics" value="price">Price
                    <input type="radio" name="topics" value="slots">Slots
                </label>
                <br>
                <label> <input type="radio" id="ascending" name="options" v-on:click="sortAscend" checked>
                    Ascending Order </label>
                <label> <input type="radio" id="descending" name="options" v-on:click="sortDescend">
                    Descending Order</label>
                <br>
                <button v-on:click="clearFilters">Clear Filters</button>
                <p> Selected filters: {{ testSort }}</p>

            </div>


            <div id="product" v-for="product in products">

                <h1>Subject: {{ product.name }}</h1>
                <img v-bind:src="product.image" height="200"> </img>
                <p>Place: {{ product.place }}</p>
                <p>Number of Slots left: {{ product.slots }}</p>
                <p>Price: {{ product.price }}</p>
                <button id="addToCart" v-if="canBeAddedToCart(product)" v-on:click="addItemToCart(product)">Add to
                    Cart</button>
                <button id="addToCart" v-else disabled>Out of Stock!</button>

            </div>


        </div>



        <footer id="footer">
            <p>GM887 2024</p>
        </footer>

    </div>

    <!-- <script src="product.js"></script> -->
    <script>
        let app = new Vue({
            el: '#app',
            data: { //array to store array items
                originalList: [],
                products: [],
                cart: [], //store items added to cart here
                showCheckout: false, //state to show checkout page
                selectedTopic: "name", //default value
                selectedOrder: "Ascending", //default value
                order: { //store order details here
                    firstName: "",
                    lastName: "",
                    phone: "",
                    lessonID: [],
                    spaces: [],
                },
            },
            methods: {
                //add product to cart array and reduce slots by 1
                addItemToCart: function (product) { //product from products is passed in as an argument
                    this.cart.push(product);
                    product.slots -= 1;
                },

                removeItemFromCart: function (product) {
                    //find in products list, increment by 1, then remove from cart
                    for (let i = 0; products.length; i++) {
                        if (this.products[i].id == product.id) {
                            this.products[i].slots += 1;
                            //remove from cart
                            this.cart.pop(product);
                        }
                    }
                },

                toggleCheckoutPage: function () {
                    // toggles showCheckout state to flip between checkout and not checkout
                    this.showCheckout = !this.showCheckout;
                },

                //retrieve and update selectedTopic data variable
                getTopicSelect: function () {
                    const topics = document.querySelectorAll('input[name="topics"]');

                    for (i = 0; i < topics.length; i++) {
                        if (topics[i].checked) {
                            this.selectedTopic = topics[i].value;
                        }
                    }
                },

                sortAscend: function () {
                    this.selectedOrder = "Ascending";
                    if (this.selectedTopic == "name") {
                        return this.products.sort((a, b) => a.name.localeCompare(b.name));
                    } else if (this.selectedTopic == "place") {
                        return this.products.sort((a, b) => a.name.localeCompare(b.place));
                    } else if (this.selectedTopic == "price") {
                        return this.products.sort((a, b) => a.price - b.price);
                    } else if (this.selectedTopic == "slots") {
                        return this.products.sort((a, b) => a.slots - b.slots);
                    } else {
                        return this.products;
                    }

                },

                sortDescend: function () {
                    this.selectedOrder = "Descending";
                    if (this.selectedTopic == "name") {
                        return this.products.sort((a, b) => b.name.localeCompare(a.name));
                    } else if (this.selectedTopic == "place") {
                        return this.products.sort((a, b) => b.name.localeCompare(a.place));
                    } else if (this.selectedTopic == "price") {
                        return this.products.sort((a, b) => b.price - a.price);
                    } else if (this.selectedTopic == "slots") {
                        return this.products.sort((a, b) => b.slots - a.slots);
                    } else {
                        return this.products;
                    }
                },

                clearFilters: function () {
                    this.selectedTopic = "Ascending";
                    this.selectedOrder = "name";
                    //reset products to original list order
                    this.products = []
                    this.products = this.originalList;
                    return this.products;
                },

                canBeAddedToCart: function (product) {
                    if (product.slots > 0) {
                        return true;
                    } else {
                        return false;
                    }
                },

                // temporary alert to show order submitted
                //send order details to mongodb
                submitForm: function () {
                    //alert("Order submitted");
                    //retrieve first name, last name, phone number
                    //update in mongodb
                    //retrieve lessonID and spaces from cart
                    //pick first id, go through cart list, see how many occur
                    //increment space by 1 everytime it occurs
                    //send lessonid and space to mongodb together (an array maybe?)
                    //go next in cart list, if id is same as previous, go next
                    //if id is different, repeat from step 2
                },
            },
            computed: {
                cartItemCount: function () {
                    return this.cart.length;
                },

                testSort: function () {
                    let str = this.selectedTopic + " " + this.selectedOrder;
                    return str;

                },

                sortAscendDescend: function () {
                    if (this.selectedOrder == "Ascending") {
                        return sortAscend();
                    } else if (this.selectedOrder == "Descending") {
                        return sortDescend();
                    } else {
                        return this.products;
                    }
                },
            },

            created: function () {
                fetch("http://localhost:3000/collections/lessons").then(
                    function (response) {
                        response.json().then(
                            function (json) {
                                app.products = json;
                                app.originalList = json;
                            }
                        )
                    }
                )
            }
        });
    </script>
</body>

</html>
